{"version":3,"file":"../js/category.js","names":["section","document","querySelector","arrCategory","hrefSrc","window","location","href","split","slice","join","categoryRender","async","category","forEach","item","title","createElement","classList","add","innerText","append","ul","fetch","then","response","json","data","index","li","addEventListener","e","localStorage","setItem","JSON","stringify","oldPrice","price","discount","Math","round","dataset","text","insertAdjacentHTML","image","appendChild","catch","err","console","log","init","push"],"sources":["category.js"],"mappings":"AACA,MAAMA,QAAUC,SAASC,cAAc,oBACjCC,YAAc,GACdC,QAAUC,OAAOC,SAASC,KAAKC,MAAM,KAAKC,MAAM,GAAI,GAAGC,KAAK,KAG5DC,eAAiBC,MAAOC,IAC1BA,EAASC,SAASC,IACd,MAAMC,EAASf,SAASgB,cAAc,MACtCD,EAAME,UAAUC,IAAI,0BACpBH,EAAMI,UAAYL,EAClBf,QAAQqB,OAAOL,GAEf,MAAMM,EAAMrB,SAASgB,cAAc,MACnCK,EAAGJ,UAAUC,IAAI,cAElBI,MAAM,4CAA4CR,KAChDS,MAAMC,GAAaA,EAASC,SAC5BF,MAAMG,GAASA,EAAKb,SAAQ,CAACC,EAAMa,KAEhC,MAAMC,EAAM5B,SAASgB,cAAc,MACnCY,EAAGX,UAAUC,IAAI,aAAc,cAAcS,EAAM,KAEnDC,EAAGC,iBAAiB,SAAUC,IAC1BC,aAAaC,QAAQ,sBAAuBC,KAAKC,UAAUpB,EAAKC,QAChEX,OAAOC,SAASC,KAAO,GAAGH,mBAAmB,IAGjD,IAAIgC,EAAWT,EAAKC,GAAOS,MACvBC,EAAW,EACXX,EAAKC,GAAOU,WACZA,EAAWX,EAAKC,GAAOU,SACvBF,EAAWG,KAAKC,MAAMJ,EAAYA,EAAS,IAAIE,GAC/CT,EAAGX,UAAUC,IAAI,uBACjBU,EAAGY,QAAQC,KAAO,GAAGf,EAAKC,GAAOU,aAGrCT,EAAGc,mBAAmB,aAAa,oEACkB5B,EAAK6B,8KAEvBjB,EAAKC,GAAOS,gEACZD,yGAGAT,EAAKC,GAAOZ,aAE/CM,EAAGuB,YAAYhB,EAAE,MAEpBiB,OAAOC,IACJC,QAAQC,IAAIF,EAAG,IAEnB/C,QAAQ6C,YAAYvB,EAAE,GAEzB,EAKC4B,KAAO,KACT3B,MAAM,sCACLC,MAAMC,GAAaA,EAASC,SAC5BF,MAAMG,GAASA,EAAKb,SAAQC,IACzBZ,YAAYgD,KAAKpC,EAAI,MAExBS,MAAK,IAAMb,eAAeR,eAC1B2C,OAAOC,IACJC,QAAQC,IAAIF,EAAG,GAClB,EARDxB,MAAM,sCACLC,MAAMC,GAAaA,EAASC,SAC5BF,MAAMG,GAASA,EAAKb,SAAQC,IACzBZ,YAAYgD,KAAKpC,EAAI,MAExBS,MAAK,IAAMb,eAAeR,eAC1B2C,OAAOC,IACJC,QAAQC,IAAIF,EAAG","sourcesContent":["\r\nconst section = document.querySelector('.recommendations');\r\nconst arrCategory = [];\r\nconst hrefSrc = window.location.href.split('/').slice(0, -1).join('/');\r\n\r\n// Рендер карточек и заголовков по категориям\r\nconst categoryRender = async (category) => {\r\n    category.forEach((item) => {\r\n        const title  = document.createElement('h3');\r\n        title.classList.add('recommendations__title');\r\n        title.innerText = item;\r\n        section.append(title);\r\n\r\n        const ul  = document.createElement('ul');\r\n        ul.classList.add('sale__list');\r\n\r\n       fetch(`http://localhost:3000/api/goods/category/${item}`)\r\n        .then((response) => response.json())\r\n        .then((data) => data.forEach((item, index) => {\r\n\r\n            const li  = document.createElement('li');\r\n            li.classList.add('sale__item', `sale__item_${index+1}`);\r\n               // переход на страницу карточки по клику\r\n            li.addEventListener('click', (e) => {\r\n                localStorage.setItem('downloadableProduct', JSON.stringify(item.title));\r\n                window.location.href = `${hrefSrc}/card.html`;\r\n            })\r\n            \r\n            let oldPrice = data[index].price;\r\n            let discount = 0;\r\n            if (data[index].discount) {\r\n                discount = data[index].discount;\r\n                oldPrice = Math.round(oldPrice + (oldPrice/100*discount));\r\n                li.classList.add('sale__item-discount');\r\n                li.dataset.text = `${data[index].discount}%`;\r\n              } \r\n\r\n            li.insertAdjacentHTML('afterbegin',`\r\n                <img loading=\"lazy\" src= http://localhost:3000/${item.image} alt=\"Картинка скидок\" class=\"stock__img\" width=\"325\" height=\"295\">\r\n                <div class=\"sale__wrapper-prices\">\r\n                    <span class=\"price-sale\">${data[index].price} ₽</span>\r\n                    <span class=\"price-full\">${oldPrice} ₽</span>\r\n                   \r\n                </div>\r\n                <p class=\"sale__description\">${data[index].title}</p>`\r\n            );\r\n            ul.appendChild(li)\r\n        })) \r\n        .catch((err) => {\r\n            console.log(err)\r\n        })\r\n        section.appendChild(ul)\r\n        \r\n    })\r\n    \r\n}\r\n\r\n// Загрузка карточек по категориям при загрузке\r\nconst init = () => {\r\n    fetch('http://localhost:3000/api/category')\r\n    .then((response) => response.json())\r\n    .then((data) => data.forEach(item => {\r\n        arrCategory.push(item)\r\n    }))\r\n    .then(() => categoryRender(arrCategory))\r\n    .catch((err) => {\r\n        console.log(err)\r\n    })\r\n}\r\ninit()\r\n"]}